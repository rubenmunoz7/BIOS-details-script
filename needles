# Needles Cleanup Script
# Ruben Munoz 10/9/2025
# ITStuntman
# Clear Needles user configuration so Needles is fresh on launch

$profiles = Get-ChildItem 'C:\Users' -Directory -ErrorAction SilentlyContinue | 
            Where-Object {$exclude -notcontains $_.Name }

# File paths
$targets = foreach ($p in $profiles) {
    Join-Path $p.FullName 'Appdata\Roaming\Needles\configuration.bin'
}

$targets += (Join-Path $env:APPDATA 'Needles\configuration.bin')
    $cfg = $_
    try {
        if (Test-Path -LiteralPath $cfg) {
            $item = Get-Item -LiteralPath $cfg -Force
            if ($item.Attributes -band [IO.FileAttributes]::ReadOnly) {
                $item.Attributes = $item.Attributes -bxor [IO.FileAttributes]::ReadOnly
            }
            Remove-Item -LiteralPath $cfg -Force -ErrorAction Stop
            Write-Output "Deleted: $cfg" # Output message
        } else {
            Write-Output "Not found: $cfg" # Output message
        }
    } catch {
        Write-Output "Failed to delete $cfg - $($_.Exception.Message)" # Output message
    }
